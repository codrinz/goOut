{"version":3,"sources":["webpack:///webpack/bootstrap 81a08e8e30830343bb0a","webpack:///./src/index.js","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///external \"http\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-cors\"","webpack:///external \"koa-router\"","webpack:///external \"mysql\"","webpack:///external \"regenerator-runtime\"","webpack:///external \"ws\""],"names":["Koa","require","mysql","app","server","createServer","callback","WebSocket","wss","Server","Router","cors","bodyparser","connection","createConnection","host","user","password","database","connect","use","ctx","next","start","Date","ms","console","log","method","url","response","status","shows","query","error","results","fields","router","broadcast","data","clients","forEach","client","readyState","OPEN","send","JSON","stringify","get","body","post","headers","request","showName","index","findIndex","show","text","operation","splice","sid","day","month","freeSpots","allSpots","routes","allowedMethods","listen"],"mappings":";;;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;;;;AChEA,IAAMA,MAAM,mBAAAC,CAAQ,CAAR,CAAZ;AACA,IAAMC,QAAQ,mBAAAD,CAAQ,CAAR,CAAd;AACA,IAAME,MAAM,IAAIH,GAAJ,EAAZ;AACA,IAAMI,SAAS,mBAAAH,CAAQ,CAAR,EAAgBI,YAAhB,CAA6BF,IAAIG,QAAJ,EAA7B,CAAf;AACA,IAAMC,YAAY,mBAAAN,CAAQ,CAAR,CAAlB;AACA,IAAMO,MAAM,IAAID,UAAUE,MAAd,CAAqB,EAACL,cAAD,EAArB,CAAZ;AACA,IAAMM,SAAS,mBAAAT,CAAQ,CAAR,CAAf;AACA,IAAMU,OAAO,mBAAAV,CAAQ,CAAR,CAAb;AACA,IAAMW,aAAa,mBAAAX,CAAQ,CAAR,CAAnB;;AAEA,IAAIY,aAAaX,MAAMY,gBAAN,CAAuB;AACpCC,UAAW,WADyB;AAEpCC,UAAW,OAFyB;AAGpCC,cAAW,OAHyB;AAIpCC,cAAW;AAJyB,CAAvB,CAAjB;AAMAL,WAAWM,OAAX;;AAEAhB,IAAIiB,GAAJ,CAAQR,YAAR;AACAT,IAAIiB,GAAJ,CAAQT,MAAR;AACAR,IAAIiB,GAAJ;AAAA,mJAAQ,iBAAgBC,GAAhB,EAAqBC,IAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AACEC,6BADF,GACU,IAAIC,IAAJ,EADV;AAAA;AAAA,+BAEEF,MAFF;;AAAA;AAGEG,0BAHF,GAGO,IAAID,IAAJ,KAAaD,KAHpB;;AAIJG,gCAAQC,GAAR,CAAeN,IAAIO,MAAnB,SAA6BP,IAAIQ,GAAjC,SAAwCR,IAAIS,QAAJ,CAAaC,MAArD,WAAiEN,EAAjE;;AAJI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAR;;AAAA;AAAA;AAAA;AAAA;;AAOA,IAAIO,QAAQ,EAAZ;;AAEAnB,WAAWoB,KAAX,CAAiB,qBAAjB,EAAwC,UAAUC,KAAV,EAAiBC,OAAjB,EAA0BC,MAA1B,EAAkC;AACtE,QAAIF,KAAJ,EAAW,MAAMA,KAAN;AACXF,YAAQG,OAAR;AACD,CAHH;;AAOA,IAAME,SAAS,IAAI3B,MAAJ,EAAf;;AAEA,IAAM4B,YAAY,SAAZA,SAAY,CAACC,IAAD;AAAA,WACd/B,IAAIgC,OAAJ,CAAYC,OAAZ,CAAoB,UAACC,MAAD,EAAY;AAC5B,YAAIA,OAAOC,UAAP,KAAsBpC,UAAUqC,IAApC,EAA0C;AACtCF,mBAAOG,IAAP,CAAYC,KAAKC,SAAL,CAAeR,IAAf,CAAZ;AACH;AACJ,KAJD,CADc;AAAA,CAAlB;;AAOAF,OAAOW,GAAP,CAAW,iBAAX,EAA6B,eAAO;AAChC3B,QAAIS,QAAJ,CAAamB,IAAb,GAAoB,MAApB;AACA5B,QAAIS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB;AACH,CAHD;;AAKAM,OAAOW,GAAP,CAAW,SAAX,EAAqB,eAAO;AACxB3B,QAAIS,QAAJ,CAAamB,IAAb,GAAoBjB,KAApB;AACAX,QAAIS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB;AACH,CAHD;;AAMAM,OAAOa,IAAP,CAAY,SAAZ,EAAuB,eAAO;AAC1B,QAAMC,UAAU9B,IAAI+B,OAAJ,CAAYH,IAA5B;AACAvB,YAAQC,GAAR,CAAY,WAAWmB,KAAKC,SAAL,CAAeI,OAAf,CAAvB;AACA,QAAME,WAAWF,QAAQE,QAAzB;AACA,QAAI,OAAOA,QAAP,IAAmB,WAAvB,EAAoC;AAChC,YAAMC,QAAQtB,MAAMuB,SAAN,CAAgB;AAAA,mBAAQC,KAAKH,QAAL,KAAkBA,QAA1B;AAAA,SAAhB,CAAd;AACA,YAAIC,UAAU,CAAC,CAAf,EAAkB;AACdjC,gBAAIS,QAAJ,CAAamB,IAAb,GAAoB,EAACQ,MAAM,cAAP,EAApB;AACApC,gBAAIS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB;AACH,SAHD,MAGO;AACHO,sBAAU;AACNoB,2BAAW,QADL;AAENF,sBAAMxB,MAAMsB,KAAN;AAFA,aAAV;AAIAtB,kBAAM2B,MAAN,CAAaL,KAAb,EAAoB,CAApB;AACAjC,gBAAIS,QAAJ,CAAamB,IAAb,GAAoB,EAACQ,MAAM,sBAAP,EAApB;AACApC,gBAAIS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB;AACH;AACJ,KAdD,MAcO;AACHV,YAAIS,QAAJ,CAAamB,IAAb,GAAoB,EAACQ,MAAM,cAAP,EAApB;AACApC,YAAIS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB;AACH;AACJ,CAtBD;;AAyBAM,OAAOa,IAAP,CAAY,MAAZ,EAAoB,eAAO;AACvB,QAAMC,UAAU9B,IAAI+B,OAAJ,CAAYH,IAA5B;AACAvB,YAAQC,GAAR,CAAY,WAAWmB,KAAKC,SAAL,CAAeI,OAAf,CAAvB;AACA,QAAMS,MAAMT,QAAQS,GAApB;AACA,QAAMP,WAAWF,QAAQE,QAAzB;AACA,QAAMQ,MAAMV,QAAQU,GAApB;AACA,QAAMC,QAAQX,QAAQW,KAAtB;AACA,QAAMC,YAAYZ,QAAQY,SAA1B;AACA,QAAMC,WAAWb,QAAQa,QAAzB;AACA,QAAG,OAAOX,QAAP,IAAmB,WAAnB,IAAkC,OAAOQ,GAAP,IAAc,WAAhD,IAA+D,OAAOC,KAAP,IAAgB,WAA/E,IAA8F,OAAOC,SAAP,IAAoB,WAAlH,IAAiI,OAAOC,QAAP,IAAmB,WAAvJ,EAAmK;AAC/J,YAAMV,QAAQtB,MAAMuB,SAAN,CAAgB;AAAA,mBAAQC,KAAKH,QAAL,KAAkBA,QAA1B;AAAA,SAAhB,CAAd;AACA,YAAGC,UAAU,CAAC,CAAd,EAAgB;AACZ,gBAAIE,OAAO;AACPI,wBADO;AAEPP,kCAFO;AAGPQ,wBAHO;AAIPC,4BAJO;AAKPC,oCALO;AAMPC;AANO,aAAX;;AASAnD,uBAAWoB,KAAX,CAAiB,iFAAjB,EAAmG,CAACoB,QAAD,EAC3FQ,GAD2F,EAE3FC,KAF2F,EAG3FC,SAH2F,EAI3FC,QAJ2F,CAAnG,EAImB,UAAU9B,KAAV,EAAiBC,OAAjB,EAA0BC,MAA1B,EAAkC;AAC7C,oBAAIF,KAAJ,EAAW,MAAMA,KAAN;AACZ,aANP;;AASAI,sBAAU;AACNoB,2BAAW,QADL;AAENF,sBAAMA;AAFA,aAAV;AAKAnC,gBAAIS,QAAJ,CAAamB,IAAb,GAAoBO,IAApB;AACAnC,gBAAIS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB;AACH,SA1BD,MA0BK;AACDV,gBAAIS,QAAJ,CAAamB,IAAb,GAAoB,EAACQ,MAAM,yBAAP,EAApB;AACApC,gBAAIS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB;AACH;AACJ,KAhCD,MAgCK;AACDV,YAAIS,QAAJ,CAAamB,IAAb,GAAoB,EAACQ,MAAM,cAAP,EAApB;AACApC,YAAIS,QAAJ,CAAaC,MAAb,GAAsB,GAAtB;AACH;AACJ,CA7CD;;AAkDA5B,IAAIiB,GAAJ,CAAQiB,OAAO4B,MAAP,EAAR;AACA9D,IAAIiB,GAAJ,CAAQiB,OAAO6B,cAAP,EAAR;;AAEA9D,OAAO+D,MAAP,CAAc,IAAd,E;;;;;;ACtIA;;;;;;;ACAA,iC;;;;;;ACAA,gC;;;;;;ACAA,2C;;;;;;ACAA,qC;;;;;;ACAA,uC;;;;;;ACAA,kC;;;;;;ACAA,gD;;;;;;ACAA,+B","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 81a08e8e30830343bb0a","const Koa = require('koa');\r\nconst mysql = require('mysql');\r\nconst app = new Koa();\r\nconst server = require('http').createServer(app.callback());\r\nconst WebSocket = require('ws');\r\nconst wss = new WebSocket.Server({server});\r\nconst Router = require('koa-router');\r\nconst cors = require('koa-cors');\r\nconst bodyparser = require('koa-bodyparser');\r\n\r\nvar connection = mysql.createConnection({\r\n    host     : 'localhost',\r\n    user     : 'admin',\r\n    password : 'admin',\r\n    database : 'showItNow'\r\n  });\r\nconnection.connect();\r\n\r\napp.use(bodyparser());\r\napp.use(cors());\r\napp.use(async function (ctx, next) {\r\n    const start = new Date();\r\n    await next();\r\n    const ms = new Date() - start;\r\n    console.log(`${ctx.method} ${ctx.url} ${ctx.response.status} - ${ms}ms`);\r\n});\r\n\r\nvar shows = []\r\n\r\nconnection.query(\"Select * from shows\", function (error, results, fields) {\r\n    if (error) throw error;\r\n    shows = results;\r\n  });\r\n  \r\n  \r\n\r\nconst router = new Router();\r\n\r\nconst broadcast = (data) =>\r\n    wss.clients.forEach((client) => {\r\n        if (client.readyState === WebSocket.OPEN) {\r\n            client.send(JSON.stringify(data));\r\n        }\r\n    });\r\n\r\nrouter.get('/testConnection',ctx => {\r\n    ctx.response.body = \"good\";\r\n    ctx.response.status = 200;\r\n});\r\n\r\nrouter.get('/getAll',ctx => {\r\n    ctx.response.body = shows;\r\n    ctx.response.status = 200;\r\n}\r\n);\r\n\r\nrouter.post('/delete', ctx => {\r\n    const headers = ctx.request.body;\r\n    console.log(\"body: \" + JSON.stringify(headers));\r\n    const showName = headers.showName;\r\n    if (typeof showName != 'undefined') {\r\n        const index = shows.findIndex(show => show.showName === showName);\r\n        if (index === -1) {\r\n            ctx.response.body = {text: 'Invalid name'};\r\n            ctx.response.status = 404;\r\n        } else {\r\n            broadcast({\r\n                operation: 'delete',\r\n                show: shows[index]\r\n            })\r\n            shows.splice(index, 1);\r\n            ctx.response.body = {text: 'The show was deleted'};\r\n            ctx.response.status = 200;\r\n        }\r\n    } else {\r\n        ctx.response.body = {text: 'Name missing'};\r\n        ctx.response.status = 404;\r\n    }\r\n}\r\n);\r\n\r\nrouter.post('/add', ctx => {\r\n    const headers = ctx.request.body;\r\n    console.log(\"body: \" + JSON.stringify(headers));\r\n    const sid = headers.sid;\r\n    const showName = headers.showName;\r\n    const day = headers.day;\r\n    const month = headers.month;\r\n    const freeSpots = headers.freeSpots;\r\n    const allSpots = headers.allSpots;\r\n    if(typeof showName != 'undefined' || typeof day != 'undefined' || typeof month != 'undefined' || typeof freeSpots != 'undefined' || typeof allSpots != 'undefined'){\r\n        const index = shows.findIndex(show => show.showName === showName);\r\n        if(index === -1){\r\n            let show = {\r\n                sid,\r\n                showName,\r\n                day,\r\n                month,\r\n                freeSpots,\r\n                allSpots\r\n            };\r\n            \r\n            connection.query(\"INSERT INTO shows(showName, day, month, freeSpots, allSpots) VALUES (?,?,?,?,?)\",[showName,\r\n                    day,\r\n                    month,\r\n                    freeSpots,\r\n                    allSpots], function (error, results, fields) {\r\n                    if (error) throw error;\r\n                  });\r\n            \r\n            \r\n            broadcast({\r\n                operation: 'insert',\r\n                show: show\r\n            }\r\n            );\r\n            ctx.response.body = show;\r\n            ctx.response.status = 200;\r\n        }else{\r\n            ctx.response.body = {text: 'The show already exists'};\r\n            ctx.response.status = 404;\r\n        }\r\n    }else{\r\n        ctx.response.body = {text: 'Missing data'};\r\n        ctx.response.status = 404;\r\n    }\r\n}\r\n);\r\n\r\n\r\n\r\napp.use(router.routes());\r\napp.use(router.allowedMethods());\r\n\r\nserver.listen(3000);\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 1\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"koa-cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-cors\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"mysql\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mysql\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"ws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ws\"\n// module id = 9\n// module chunks = 0"],"sourceRoot":""}